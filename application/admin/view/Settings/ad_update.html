{extend name="base" /}

{block name="content"}
<div class="breadcrumbs">
    <div class="breadcrumbs-inner">
        <div class="row m-0">
            <div class="col-sm-4">
                <div class="page-header float-left">
                    <div class="page-title">
                        <h1>修改广告</h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="page-header float-right">
                    <div class="page-title">
                        <ol class="breadcrumb text-right">
                            <li><a href="{:url('Index/index')}">首页</a></li>
                            <li><a href="###">系统设置</a></li>
                            <li><a href="{:url('Settings/ad')}">广告列表</a></li>
                            <li class="active">修改广告</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content">
    <div class="animated fadeIn">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body card-block">
                        <div class="form-group">
                            <label for="title" class=" form-control-label">标题</label>
                            <input type="text" id="title" value="{$detail.title}" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="sign" class=" form-control-label">标签</label>
                            <input type="text" id="sign" value="{$detail.sign}" class="form-control">
                        </div>  
                        <div class="row form-group">
                            <div class="col col-md-8"><label for="content" class=" form-control-label">内容</label></div>
                            <div class="col-12 col-md-9"><textarea name="content" id="content" rows="9" placeholder="Content..." class="form-control">{$detail.content}</textarea></div>
                        </div>
                        <div class="row form-group">
                            <div class="col col-md-8"><label for="image" class=" form-control-label">图片</label></div>
                            <div class="col-12 col-md-9"><input type="file" id="image" name="image" class="form-control-file"></div>
                        </div>
                        {if condition="$detail.image != ''"}
                        <img id="show_image" src="{$detail.image}" width="80px"/>
                        {/if}
                        <div class="row form-group">
                            <div class="col-8">
                                <div class="form-group">
                                    <label for="sort" class="form-control-label">排序</label>
                                    <input type="number" id="sort" value="{$detail.sort}" class="form-control" min="0" step="1">
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="id" name="id" value="{$detail.id}"/>
                        <div>
                            <button id="submit" type="button" class="btn btn-lg btn-info btn-block">
                                <i class="fa fa-arrow-up fa-lg"></i>&nbsp;
                                <span id="payment-button-amount">提交</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div>
{/block}

{block name="custom_js"}
    <script>
        $("#show_image").click(function(){
            layer.open({
                type: 1,
                title: false,
                closeBtn: 0,
                area: '516px',
                skin: 'layui-layer-nobg', //没有背景色
                shadeClose: true,
                content: "<img src='"+ $(this).attr('src') +"'/>"
            });
        })

        $("#submit").click(function(){
            var fd = new FormData();
            fd.append("id", $("#id").val());
            fd.append("title", $("#title").val());
            fd.append("sort", $("#sort").val());
            fd.append("sign", $("#sign").val());
            fd.append("content", $("#content").val());
            fd.append("image", $('#image')[0].files[0]);
            if(title == ''){
                layer.msg('请填写标题！');
                return;
            }
            if(sign == ''){
                layer.msg('请填写标签！');
                return;
            }
            $.ajax({
                url: "{:url('settings/ad_update_submit')}",
                type: "post",
                processData: false,
                contentType: false,
                data: fd,
                success: function(data){
                    layer.msg(data.msg);
                    if(data.status == 1){
                        setTimeout(function(){
                            window.location.href = "{:url('settings/ad')}";
                        }, 1000);
                    }
                }
            })
        })
    </script>
{/block}